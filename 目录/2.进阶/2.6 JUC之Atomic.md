
Java中java.util.concurrent.atomic包下的原子类都是基于CAS实现的。

一 什么是CAS

CAS 指CompareAndSwap，顾名思义，先比较后交换。

CAS有三个变量：内存地址V，期待值A，更新值B。

当且仅当内存地址V对应的值与期待值A相等时，将内存地址V对应的值更换为B，否则不修改并告诉V的值。

当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值，而其它线程都将失败。然而，失败的线程并不会被挂起（这与获取锁的情况

不同：当获取锁失败时，线程将被挂起），二十被告知在这次竞争中失败，并可以再次尝试。由于一个线程在竞争CAS时失败不会阻塞，因此它可以决定是否重新尝试，或者执行一些恢复操作，也或者不执行任何操作。这种灵活性就大大减少了与锁修改的活跃性风险。

由于CAS能检测到来自其它线程的干扰，因此即使不使用锁也能够实现原子的读-改-写操作序列。

二
